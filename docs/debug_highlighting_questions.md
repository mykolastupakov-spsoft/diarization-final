# 10 питань для діагностики проблеми з підсвічуванням тексту

## Статус діагностики:
- ✅ Додано діагностичне логування в `highlightTextWithColors` (консоль браузера)
- ✅ Додано діагностичне логування в `renderTextComparisonTable` (консоль браузера)
- ✅ Додано діагностичне логування на сервері при формуванні `fullResult`
- ⚠️ Потрібно перевірити консоль браузера під час рендерингу таблиці

## Питання для пошуку в інтернеті:

1. **Як правильно знаходити підрядки в тексті з урахуванням нормалізації (lowercase, видалення пунктуації) в JavaScript, зберігаючи позиції в оригінальному тексті?**

2. **Які є найкращі практики для пошуку та виділення фраз у HTML-тексті з урахуванням перекриттів та пріоритетів кольорів?**

3. **Як правильно обробляти Unicode, арабські символи та спеціальні символи при пошуку тексту з нормалізацією в JavaScript?**

4. **Як перевірити, чи правильно передаються дані з сервера на клієнт через Server-Sent Events (SSE) та чи зберігаються вони в об'єкті recording?**

5. **Як діагностувати проблеми з DOM-маніпуляціями та innerHTML, коли HTML-теги не відображаються або не застосовуються стилі?**

6. **Які є альтернативні підходи до виділення тексту в HTML (Range API, Selection API, TextNode маніпуляції) замість innerHTML з span-тегами?**

7. **Як правильно обробляти перекриття виділень з різними пріоритетами кольорів, коли одна фраза може належати до кількох категорій?**

8. **Які є поширені помилки при роботі з innerHTML та екрануванням HTML (escapeHtml), коли стилі не застосовуються до виділеного тексту?**

9. **Як перевірити, чи правильно працює функція highlightTextWithColors в контексті динамічного рендерингу таблиці через innerHTML?**

10. **Як ефективно знаходити послідовності слів у тексті з урахуванням можливих варіацій форматування (пробіли, пунктуація, регістр) та зберігати точні позиції для виділення?**

---

## Додаткові питання для діагностики:

11. **Як перевірити, чи правильно зберігається textAnalysis в об'єкті recording після отримання через SSE?**

12. **Які є способи діагностики проблем з підсвічуванням тексту в браузері (console.log, breakpoints, DOM inspector)?**

13. **Як правильно обробляти випадки, коли текст у textAnalysis не збігається точно з текстом у сегментах через різницю в нормалізації?**

14. **Які є найкращі алгоритми для fuzzy matching тексту з урахуванням нормалізації та знаходження позицій у оригінальному тексті?**

15. **Як правильно обробляти випадки, коли фраза з textAnalysis містить слова, які розділені іншими словами в оригінальному тексті?**

---

## Конкретні питання для діагностики поточної проблеми:

### 1. Перевірка передачі даних:
- **Чи передається `textAnalysis` через SSE в `fullResult`?** (перевірити логи сервера)
- **Чи зберігається `textAnalysis` в `recording.textAnalysis` після `attachOverlapResultToRecording`?** (перевірити консоль браузера)
- **Чи передається `textAnalysis` в `renderTextComparisonTableFromSegments`?** (перевірити консоль браузера)

### 2. Перевірка логіки пошуку:
- **Чи знаходить `findPhraseInText` фрази в тексті?** (перевірити консоль браузера - має бути "Found highlights")
- **Чи правильно нормалізується текст для порівняння?** (перевірити, чи збігаються нормалізовані версії)
- **Чи правильно обчислюються позиції в оригінальному тексті?** (перевірити, чи позиції не виходять за межі тексту)

### 3. Перевірка рендерингу:
- **Чи генерується HTML з span-тегами?** (перевірити в DOM inspector)
- **Чи застосовуються inline стилі до span-тегів?** (перевірити в DOM inspector)
- **Чи не екранується HTML двічі?** (перевірити, чи не використовується `escapeHtml` на вже екранованому HTML)

### 4. Конкретні кроки для діагностики:
1. Відкрити консоль браузера (F12)
2. Запустити workflow з overlap diarization
3. Перевірити логи:
   - На сервері: чи є логи "Text Analysis in fullResult"?
   - В браузері: чи є логи "renderTextComparisonTable: textAnalysis found"?
   - В браузері: чи є логи "highlightTextWithColors: Found highlights"?
4. Якщо немає логів "Found highlights", перевірити:
   - Чи є дані в textAnalysis?
   - Чи збігаються фрази з текстом сегментів?
   - Чи правильно обчислюються позиції?

### 5. Можливі проблеми:
- **Проблема 1**: textAnalysis не передається через SSE
  - **Рішення**: Перевірити `server.js`, чи правильно додається `textAnalysis` в `fullResult`
- **Проблема 2**: textAnalysis не зберігається в recording
  - **Рішення**: Перевірити `attachOverlapResultToRecording`, чи правильно присвоюється `recording.textAnalysis`
- **Проблема 3**: Фрази не знаходяться через різницю в нормалізації
  - **Рішення**: Покращити логіку нормалізації або використати fuzzy matching
- **Проблема 4**: Позиції обчислюються неправильно
  - **Рішення**: Використати точний пошук з збереженням позицій в оригінальному тексті
- **Проблема 5**: HTML не рендериться правильно
  - **Рішення**: Перевірити, чи не екранується HTML двічі, чи правильно застосовуються стилі

