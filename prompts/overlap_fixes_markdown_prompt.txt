You are an expert in dialogue transcription and speaker diarization analysis.

Your task is to analyze two sets of diarization segments (one per voice track) and create a corrected, deduplicated Markdown table with STRICT dialogue alternation.
SOURCE OF TRUTH WARNING: The ONLY trusted data is the individual segment objects contained in the provided JSON arrays (each entry has text, start/end, metadata). Evaluate every segment independently. You are not allowed to invent, rewrite, or omit any factual content. Every sentence that appears in the final table must come verbatim from one of these segments (including fillers like "uh", "um", etc.).

CRITICAL RULES:
1. **STRICT DIALOGUE ALTERNATION**: The dialogue MUST alternate between Agent and Client. You CANNOT have two consecutive Agent segments or two consecutive Client segments. If you see two segments from the same speaker in a row, one of them is likely a duplicate or misassigned - remove it or reassign based on context and role information.

2. **DETERMINE TRUE SPEAKER**: Each segment includes metadata (`speaker_id`, `role`, `sourceTrack`), but these hints can be wrong. Decide whether the segment belongs to the Agent or the Client by combining:
   - Conversational intent (who is offering service vs. requesting help)
   - Metadata as guidance (not absolute truth)
   - Neighboring context (chronology and call structure)

3. **REMOVE MISASSIGNED DUPLICATES ONLY**: The goal is to remove sentences that were attached to the wrong speaker (e.g., the same line appears once under Agent and once under Client). If both copies belong to the SAME speaker (same role + same transcript), KEEP them. Remove a segment only when it clearly belongs to the other speaker or is a true duplicate of the exact same moment. Prefer the version whose role matches the speaker that actually said it.

4. **PRESERVE LEGITIMATE CONTENT**: Never delete or shorten a segment that truly belongs to that speaker. If a sentence exists only once in the source segments, it MUST appear in the final table. Only remove a segment if it is clearly a misassignment.

5. **KEEP SEGMENTS WHOLE**: Treat each segment as atomic. Do NOT split a segment into multiple rows even if it contains multiple sentences or overlaps with the other speaker.

6. **MERGE OVERLAPPING SAME-SPEAKER SEGMENTS**: If multiple segments from the same speaker overlap in time or fall entirely between another speaker's timestamps, merge them into one row using the earliest start, latest end, and concatenated text (in chronological order). This ensures their speech stays in a single message.

7. **KEEP VERBATIM TEXT**: Do NOT remove filler or hesitation words (e.g., "uh", "um", "ah"). Preserve the transcript exactly as provided (apart from dropping segments that clearly belong to the other person).

8. **USE TIMESTAMPS**: Extract start and end times directly from the segment objects.

9. **CHRONOLOGICAL ORDER**: Sort all accepted (and merged) segments by start time in ascending order.

PROCESSING STEPS:
1. Analyze both segment lists (Agent track and Client track).
2. Review the metadata inside each segment (`role`, `speaker_id`, `sourceTrack`) to understand how it was originally labeled.
3. Extract every segment object from both lists.
4. Identify which segments belong to Agent and which to Client by considering:
   - Conversational context (questions → answers, statements → responses)
   - Metadata hints (`role`, `speaker_id`, track origin)
   - Professional vs casual language patterns
5. Examine each segment independently. If it clearly belongs to the other participant (e.g., the Agent track captured a client reply), reassign or drop that misassigned copy.
6. Remove duplicate segments ONLY when they represent the exact same utterance captured in both tracks. Keep one copy aligned to the correct speaker.
7. If multiple same-speaker segments overlap or fall inside another speaker's time window, merge them into one continuous segment (earliest start, latest end, concatenated text).
8. Keep all original words (including fillers); no text deletions unless the entire segment is discarded for being a misassignment.
9. Sort all accepted (and merged) segments chronologically by start time.
10. **ENFORCE STRICT ALTERNATION**: After sorting, check that segments alternate Agent → Client → Agent → Client. If you see two consecutive segments from the same speaker:
   - First confirm whether both sentences genuinely belong to that speaker (per your evaluation). If yes, KEEP them even if alternation temporarily breaks.
   - Only remove/reassign when a sentence clearly belongs to the other speaker (duplicate captured in the wrong track).
   - Adjust speaker assignment cautiously so alternation is restored without deleting true content.
11. Produce the final Markdown table once misassignments and overlaps are resolved.

INPUT DATA:

**AGENT TRACK SEGMENTS (JSON):**
{{AGENT_TRANSCRIPT}}

**CLIENT TRACK SEGMENTS (JSON):**
{{CLIENT_TRANSCRIPT}}

**TOTAL SEGMENTS:** {{SEGMENT_COUNT}}

**IMPORTANT**: Metadata (`role`, `speaker_id`, `sourceTrack`) is advisory only. Determine the true speaker for each segment using conversational meaning plus metadata. You are responsible for deciding who is Agent vs Client in the final table.

OUTPUT: Return a Markdown table with the following columns:
- **Segment ID** (sequential number starting from 1)
- **Speaker** (Agent or Client - MUST alternate strictly: Agent → Client → Agent → Client)
- **Text** (verbatim text from segments; only adjust speaker assignment or merge true duplicates)
- **Start Time** (start time in seconds from segment, format: X.XX)
- **End Time** (end time in seconds from segment, format: X.XX)

Example table format:
| Segment ID | Speaker | Text | Start Time | End Time |
|------------|---------|------|------------|----------|
| 1 | Agent | Hello, how can I help you? | 0.64 | 2.15 |
| 2 | Client | Hi, I need help | 2.30 | 3.45 |
| 3 | Agent | Sure, what can I do for you? | 3.50 | 5.20 |

**EXAMPLE OF INCORRECT TABLE (DO NOT CREATE THIS):**
| Segment ID | Speaker | Text | Start Time | End Time |
|------------|---------|------|------------|----------|
| 1 | Agent | Hello, this is Alex from HealthCare. | 0.70 | 5.20 |
| 2 | Client | Hello, this is Alex from HealthCare. | 0.60 | 2.80 |
| 3 | Client | Can we talk now? | 5.90 | 8.30 |
| 4 | Agent | Yes, I'm ready. | 7.80 | 12.00 |
| 5 | Agent | Sure. | 12.10 | 13.00 |
| 6 | Client | I need to change my appointment. | 13.05 | 15.00 |
| 7 | Agent | We can't change appointments directly. | 14.90 | 17.00 |
| 8 | Client | Can you do it? | 17.10 | 20.00 |
| 9 | Agent | Sure, let's do that. | 20.05 | 22.00 |
| 10 | Client | Thanks. | 21.90 | 23.00 |
| 11 | Agent | Your appointment is on July 10 at 2 PM. | 15.94 | 22.92 |
| 12 | Client | What time? | 25.80 | 28.00 |
| 13 | Agent | At 2 PM. | 28.05 | 30.00 |
| 14 | Client | Can I reschedule? | 29.90 | 32.00 |
| 15 | Agent | Next available is July 12. | 32.10 | 34.00 |
| 16 | Client | Okay. | 33.90 | 35.00 |
| 17 | Agent | We'll send a reminder. | 35.05 | 37.00 |
| 18 | Client | Thanks. | 36.90 | 38.00 |
| 19 | Agent | All set. | 38.05 | 40.00 |
| 20 | Client | Bye. | 39.90 | 41.00 |
| 21 | Agent | Bye. | 40.05 | 42.00 |
| 22 | Client | Bye. | 41.90 | 43.00 |
| 23 | Agent | Thank you for calling. | 42.05 | 44.00 |
| 24 | Client | Thank you. | 43.90 | 45.00 |
| 25 | Agent | Have a nice day. | 44.05 | 46.00 |
| 26 | Client | Bye. | 45.90 | 47.00 |
| 27 | Agent | Bye. | 46.05 | 48.00 |
| 28 | Client | Bye. | 47.90 | 49.00 |
| 29 | Agent | Bye. | 48.05 | 50.00 |
| 30 | Client | Bye. | 49.90 | 51.00 |

**PROBLEMS IN THE INCORRECT TABLE:**
1. **Violation of alternation**: Rows 1-2 both have "Hello, this is Alex from HealthCare" (duplicate, both should not exist). Rows 4-5 both are Agent (violates alternation). Rows 20-30 have multiple "Bye" duplicates.
2. **Semantic duplicates**: Rows 1-2 have identical text assigned to both Agent and Client - this is a duplicate caused by poor audio separation. Only ONE should exist.
3. **Repeated duplicates**: "Bye" appears multiple times (rows 20, 21, 22, 26, 27, 28, 29, 30) - these are duplicates that should be removed.
4. **Temporal issues**: Row 11 overlaps with previous segments (starts at 15.94 but row 10 ends at 23.00).

**EXAMPLE OF CORRECT TABLE (CREATE THIS FORMAT):**
| Segment ID | Speaker | Text | Start Time | End Time |
|------------|---------|------|------------|----------|
| 1 | Agent | Hello, this is Alex from HealthCare. | 0.70 | 5.20 |
| 2 | Client | Can we talk now? | 5.90 | 8.30 |
| 3 | Agent | Yes, I'm ready. | 7.80 | 12.00 |
| 4 | Client | I need to change my appointment. | 13.05 | 15.00 |
| 5 | Agent | We can't change appointments directly, but I can help you reschedule. | 14.90 | 17.00 |
| 6 | Client | Can you do it? | 17.10 | 20.00 |
| 7 | Agent | Sure, let's do that. | 20.05 | 22.00 |
| 8 | Client | Thanks. | 21.90 | 23.00 |
| 9 | Agent | Your appointment is on July 10 at 2 PM. | 23.50 | 26.00 |
| 10 | Client | What time? | 25.80 | 28.00 |
| 11 | Agent | At 2 PM. | 28.05 | 30.00 |
| 12 | Client | Can I reschedule? | 29.90 | 32.00 |
| 13 | Agent | Next available is July 12. | 32.10 | 34.00 |
| 14 | Client | Okay. | 33.90 | 35.00 |
| 15 | Agent | We'll send a reminder. | 35.05 | 37.00 |
| 16 | Client | Thanks. | 36.90 | 38.00 |
| 17 | Agent | All set. Thank you for calling. | 38.05 | 41.00 |
| 18 | Client | Bye. | 39.90 | 41.00 |

**WHY THE CORRECT TABLE IS GOOD:**
1. **Strict alternation**: Agent → Client → Agent → Client (no two consecutive segments from same speaker)
2. **No duplicates**: Removed duplicate "Hello, this is Alex from HealthCare" (kept only Agent version). Removed multiple "Bye" duplicates (kept only one).
3. **No semantic duplicates**: Same content doesn't appear for both Agent and Client
4. **No hallucinations**: All text exists in the source segment lists
5. **Proper timestamps**: All timestamps are from original segments, no overlapping issues

IMPORTANT:
- Extract timestamps (start, end) from the segment objects.
- Use metadata hints (`role`, `speaker_id`, source track) plus conversational context to infer the true speaker.
- Remove ONLY misassigned duplicates - if the same text appears twice but belongs to one speaker, keep the correct one and delete the misassigned copy.
- Remove semantic duplicates ONLY when they are the exact same moment spoken by one person but mislabeled as the other person.
- Keep all original words (including fillers). No cleaning or rewriting is allowed.
- Sort all segments chronologically by start time.
- **ENFORCE STRICT ALTERNATION** carefully: preserve all authentic sentences even if it causes a temporary double Agent/Client. Adjust assignments only when confident a sentence was mislabeled.
- Ensure no temporal overlaps unless they represent actual overlapping speech.
- **CRITICAL FOR REASONING MODELS**: After your reasoning process, you MUST generate the final Markdown table in the `content` field. Do not leave `content` empty. The table is the required output.
- Return ONLY the Markdown table, no additional text or explanations.
- **RELEVANCE SAFEGUARD**: If a sentence exists in the source segments and matches its inferred speaker/context, it MUST stay in the final table. Deleting real user/agent speech is not allowed.
