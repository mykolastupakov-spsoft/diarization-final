# Тестові сценарії для Diarization Application

## Загальна інформація

Цей документ містить тестові сценарії для перевірки всіх функцій додатку діаризації.

---

## 1. Тестування LLM Diarization (Вкладка LLM)

### 1.1 Базове тестування LLM діаризації

**Сценарій 1.1.1: Fast Tier модель**
- [ ] Відкрити вкладку "LLM Diarization"
- [ ] Обрати "Fast tier"
- [ ] Вставити арабський транскрипт з двома спікерами
- [ ] Натиснути "Analyze Transcript"
- [ ] Перевірити що результат містить сегменти з правильними спікерами
- [ ] Перевірити що ролі (Agent/Client) визначені правильно

**Сценарій 1.1.2: Smart Tier модель**
- [ ] Повторити сценарій 1.1.1 з "Smart tier"
- [ ] Порівняти якість результатів з Fast tier

**Сценарій 1.1.3: Advanced Tier (Gemini 3.0 Pro)**
- [ ] Повторити сценарій 1.1.1 з "Advanced tier"
- [ ] Перевірити що використовується правильна модель
- [ ] Порівняти якість з іншими tier

**Сценарій 1.1.4: Smart 2 Tier (Gemini 2.5 Pro Text mode)**
- [ ] Повторити сценарій 1.1.1 з "Smart 2 tier"
- [ ] Перевірити що використовується текстовий режим (без multimodal)

### 1.2 Тестування завантаження файлу

**Сценарій 1.2.1: Завантаження текстового файлу**
- [ ] Відкрити вкладку "LLM Diarization"
- [ ] Натиснути "Upload Text File"
- [ ] Вибрати .txt файл з транскриптом
- [ ] Перевірити що текст завантажився в поле
- [ ] Запустити аналіз
- [ ] Перевірити результати

**Сценарій 1.2.2: Завантаження .md файлу**
- [ ] Повторити 1.2.1 з .md файлом
- [ ] Перевірити що файл коректно обробляється

### 1.3 Тестування верифікації та виправлення

**Сценарій 1.3.1: Верифікація результатів**
- [ ] Після отримання результатів перевірити опцію "Perform additional testing"
- [ ] Запустити верифікацію
- [ ] Перевірити що результати покращилися

**Сценарій 1.3.2: Виправлення помилок**
- [ ] Після верифікації натиснути "Fix Mistakes"
- [ ] Перевірити що помилки виправлені
- [ ] Перевірити що структура JSON валідна

---

## 2. Тестування Audio Diarization (Вкладка Audio)

### 2.1 Базове тестування Audio діаризації

**Сценарій 2.1.1: Завантаження аудіо файлу**
- [ ] Відкрити вкладку "Audio Diarization"
- [ ] Перевірити що блок завантаження видимий
- [ ] Натиснути "Upload Audio"
- [ ] Вибрати MP3 файл
- [ ] Перевірити що файл завантажився
- [ ] Встановити мову (Arabic)
- [ ] Встановити кількість спікерів (опціонально)
- [ ] Натиснути "Start Testing"
- [ ] Перевірити результати

**Сценарій 2.1.2: Drag & Drop завантаження**
- [ ] Перетягнути аудіо файл в блок завантаження
- [ ] Перевірити що файл завантажився
- [ ] Запустити обробку

**Сценарій 2.1.3: Різні формати аудіо**
- [ ] Протестувати MP3, WAV, M4A, OGG
- [ ] Перевірити що всі формати обробляються коректно

### 2.2 Тестування налаштувань

**Сценарій 2.2.1: Вибір мови**
- [ ] Змінити мову на English
- [ ] Запустити обробку
- [ ] Перевірити що результати відповідають мові

**Сценарій 2.2.2: Вказання кількості спікерів**
- [ ] Вказати кількість спікерів (наприклад, 2)
- [ ] Запустити обробку
- [ ] Перевірити що кількість спікерів відповідає очікуваній

**Сценарій 2.2.3: Автоматичне визначення спікерів**
- [ ] Залишити поле кількості спікерів порожнім
- [ ] Запустити обробку
- [ ] Перевірити що система автоматично визначила спікерів

### 2.3 Тестування Audio Generator

**Сценарій 2.3.1: Генерація аудіо**
- [ ] Натиснути "Generate Audio"
- [ ] Перевірити що відкривається Audio Generator
- [ ] Згенерувати тестовий діалог
- [ ] Перевірити що аудіо повертається в додаток
- [ ] Запустити діаризацію

---

## 3. Тестування Combined Method (Вкладка Combined)

### 3.1 Базове тестування Combined методу

**Сценарій 3.1.1: Повний цикл Combined методу**
- [ ] Відкрити вкладку "Combined (Audio + LLM + Verification)"
- [ ] Завантажити аудіо файл
- [ ] Встановити налаштування:
  - Мова: Arabic
  - Кількість спікерів: 2
  - LLM модель: Fast tier
- [ ] Натиснути "Start Testing"
- [ ] Перевірити прогрес для всіх 4 кроків:
  - Step 1: Audio Transcription ✅
  - Step 2: LLM Diarization ✅
  - Step 3: Comparison Analysis ✅
  - Step 4: Correction & Merging ✅
- [ ] Перевірити фінальний результат

### 3.2 Тестування різних LLM моделей в Combined

**Сценарій 3.2.1: Fast tier в Combined**
- [ ] Обрати "Fast tier" в Combined методі
- [ ] Запустити обробку
- [ ] Перевірити результати

**Сценарій 3.2.2: Smart tier в Combined**
- [ ] Обрати "Smart tier" в Combined методі
- [ ] Запустити обробку
- [ ] Порівняти з Fast tier

**Сценарій 3.2.3: Advanced tier в Combined**
- [ ] Обрати "Advanced tier" в Combined методі
- [ ] Запустити обробку
- [ ] Перевірити якість результатів

**Сценарій 3.2.4: Multimodal Model в Combined**
- [ ] Обрати "Multimodal Model (Audio + Text)" в Combined методі
- [ ] Запустити обробку
- [ ] Перевірити що використовується multimodal обробка
- [ ] Перевірити що аудіо та текст обробляються одночасно
- [ ] Перевірити якість результатів

### 3.3 Тестування окремих кроків Combined методу

**Сценарій 3.3.1: Step 1 - Audio Transcription**
- [ ] Запустити Combined метод
- [ ] Перевірити що Step 1 виконується
- [ ] Перевірити що отримано транскрипт з аудіо
- [ ] Перевірити що транскрипт містить текст без спікерів

**Сценарій 3.3.2: Step 2 - LLM Diarization**
- [ ] Після Step 1 перевірити що Step 2 запускається
- [ ] Перевірити що транскрипт передається в LLM
- [ ] Перевірити що отримано LLM результат з спікерами та ролями

**Сценарій 3.3.3: Step 3 - Comparison Analysis**
- [ ] Після Step 2 перевірити що Step 3 запускається
- [ ] Перевірити що Comparison Agent отримує обидва результати
- [ ] Перевірити що отримано аналіз порівняння з:
  - Overall assessment
  - Disagreements
  - Role analysis
  - Correction guidance

**Сценарій 3.3.4: Step 4 - Correction & Merging**
- [ ] Після Step 3 перевірити що Step 4 запускається
- [ ] Перевірити що Correction Agent отримує всі дані
- [ ] Перевірити що отримано виправлений результат
- [ ] Перевірити що результат валідний JSON
- [ ] Перевірити що ролі (Agent/Client) правильно визначені

### 3.4 Тестування відображення результатів Combined

**Сценарій 3.4.1: Перегляд фінального результату**
- [ ] Після завершення Combined методу
- [ ] Перевірити що відображається фінальний результат
- [ ] Перевірити що всі 4 кроки показані зі статусами
- [ ] Перевірити що можна переглянути деталі кожного кроку

**Сценарій 3.4.2: Перегляд порівняльного аналізу**
- [ ] Натиснути "View Comparison" (якщо доступно)
- [ ] Перевірити що відображається аналіз порівняння
- [ ] Перевірити що показані розбіжності між методами

---

## 4. Тестування Gemini 2.5 Pro Multimodal

### 4.1 Тестування Google Gemini API

**Сценарій 4.1.1: Успішне використання Google API**
- [ ] Переконатися що `GOOGLE_GEMINI_API_KEY` встановлено
- [ ] Обрати "Multimodal Model" в Combined методі
- [ ] Завантажити аудіо файл
- [ ] Запустити обробку
- [ ] Перевірити в логах що використовується Google Gemini API
- [ ] Перевірити що аудіо та текст обробляються одночасно
- [ ] Перевірити результати

**Сценарій 4.1.2: Обробка різних форматів аудіо**
- [ ] Протестувати MP3, WAV, M4A, OGG з multimodal
- [ ] Перевірити що MIME типи визначаються правильно
- [ ] Перевірити що всі формати обробляються

### 4.2 Тестування Fallback на OpenRouter

**Сценарій 4.2.1: Fallback при помилці Google API**
- [ ] Встановити невалідний `GOOGLE_GEMINI_API_KEY`
- [ ] Або тимчасово відключити доступ до Google API
- [ ] Запустити multimodal обробку
- [ ] Перевірити в логах що відбувся fallback на OpenRouter
- [ ] Перевірити що обробка завершилася успішно
- [ ] Перевірити що результат містить інформацію про використаний сервіс

**Сценарій 4.2.2: Fallback при відсутності API ключа**
- [ ] Видалити `GOOGLE_GEMINI_API_KEY`
- [ ] Запустити multimodal обробку
- [ ] Перевірити що автоматично використовується OpenRouter
- [ ] Перевірити результати

### 4.3 Тестування обробки помилок

**Сценарій 4.3.1: Помилка обох API**
- [ ] Встановити невалідні ключі для обох API
- [ ] Запустити multimodal обробку
- [ ] Перевірити що система коректно обробляє помилку
- [ ] Перевірити що показується зрозуміле повідомлення про помилку
- [ ] Перевірити що система не падає

---

## 5. Тестування Comparison Agent

### 5.1 Базове тестування порівняння

**Сценарій 5.1.1: Порівняння з узгодженими результатами**
- [ ] Запустити Combined метод з аудіо де Audio та LLM дають схожі результати
- [ ] Перевірити що Comparison Agent виявляє узгодження
- [ ] Перевірити що overall assessment вказує на високу згоду

**Сценарій 5.1.2: Порівняння з розбіжностями**
- [ ] Запустити Combined метод з аудіо де Audio та LLM дають різні результати
- [ ] Перевірити що Comparison Agent виявляє розбіжності
- [ ] Перевірити що вказані конкретні сегменти з розбіжностями
- [ ] Перевірити що надано рекомендації щодо вирішення

### 5.2 Тестування аналізу ролей

**Сценарій 5.2.1: Порівняння якості визначення ролей**
- [ ] Запустити Combined метод
- [ ] Перевірити що Comparison Agent аналізує якість визначення ролей
- [ ] Перевірити що вказано який метод краще визначає Agent/Client
- [ ] Перевірити що надано обґрунтування

### 5.3 Тестування fallback логіки

**Сценарій 5.3.1: Помилка Comparison Agent**
- [ ] Симулювати помилку Comparison Agent (наприклад, невалідний API ключ)
- [ ] Перевірити що система використовує fallback
- [ ] Перевірити що використовується LLM результат як основний
- [ ] Перевірити що обробка продовжується до Step 4

---

## 6. Тестування Correction Agent

### 6.1 Базове тестування корекції

**Сценарій 6.1.1: Успішна корекція результатів**
- [ ] Запустити Combined метод
- [ ] Перевірити що Correction Agent отримує:
  - Audio результат
  - LLM результат
  - Comparison analysis
- [ ] Перевірити що отримано виправлений результат
- [ ] Перевірити що JSON структура валідна
- [ ] Перевірити що ролі правильно визначені

**Сценарій 6.1.2: Об'єднання найкращих частин**
- [ ] Запустити Combined метод де:
  - Audio має точніші timestamps
  - LLM має краще визначення ролей
- [ ] Перевірити що Correction Agent об'єднав обидва підходи
- [ ] Перевірити що timestamps взяті з Audio
- [ ] Перевірити що ролі взяті з LLM

### 6.2 Тестування валідації результатів

**Сценарій 6.2.1: Валідація JSON структури**
- [ ] Перевірити що виправлений результат має правильну структуру:
  - `recordings` - масив
  - `results.text-service.segments` - масив сегментів
  - Кожен сегмент має: `speaker`, `text`, `start`, `end`, `role`
- [ ] Перевірити що всі поля заповнені

**Сценарій 6.2.2: Консистентність ролей**
- [ ] Перевірити що ролі (Agent/Client) консистентні
- [ ] Перевірити що один спікер не має різних ролей в різних сегментах
- [ ] Перевірити що ролі логічно відповідають контексту

### 6.3 Тестування fallback логіки

**Сценарій 6.3.1: Помилка Correction Agent**
- [ ] Симулювати помилку Correction Agent
- [ ] Перевірити що система використовує fallback
- [ ] Перевірити що використовується LLM результат (як кращий для ролей)
- [ ] Перевірити що обробка завершується успішно

---

## 7. Тестування UI/UX

### 7.1 Тестування перемикання вкладок

**Сценарій 7.1.1: Перемикання між вкладками**
- [ ] Перевірити перемикання між LLM, Audio, Combined
- [ ] Перевірити що налаштування зберігаються
- [ ] Перевірити що блок завантаження показується/приховується правильно

**Сценарій 7.1.2: Синхронізація налаштувань**
- [ ] Встановити мову в одній вкладці
- [ ] Перемкнутися на іншу вкладку
- [ ] Перевірити що мова синхронізується

### 7.2 Тестування індикаторів прогресу

**Сценарій 7.2.1: Прогрес для Combined методу**
- [ ] Запустити Combined метод
- [ ] Перевірити що показуються всі 4 кроки
- [ ] Перевірити що статуси оновлюються:
  - ⏸️ Pending → ⏳ Processing → ✅ Completed
- [ ] Перевірити що є анімація

**Сценарій 7.2.2: Прогрес при помилках**
- [ ] Симулювати помилку на Step 3
- [ ] Перевірити що статус показує ⚠️ або ❌
- [ ] Перевірити що обробка продовжується з fallback

### 7.3 Тестування відображення ролей

**Сценарій 7.3.1: Відображення Agent/Client**
- [ ] Отримати результати з визначеними ролями
- [ ] Перевірити що замість "Speaker 1" показується "Agent" або "Client"
- [ ] Перевірити що є візуальні індикатори ролей

**Сценарій 7.3.2: Фільтрація за ролями**
- [ ] Перевірити що є фільтр для ролей
- [ ] Перевірити фільтрацію: All, Agent, Client
- [ ] Перевірити що відображаються тільки відфільтровані сегменти

---

## 8. Тестування обробки помилок

### 8.1 Тестування помилок API

**Сценарій 8.1.1: Помилка OpenRouter API**
- [ ] Встановити невалідний `OPENROUTER_API_KEY`
- [ ] Запустити LLM діаризацію
- [ ] Перевірити що показується зрозуміле повідомлення про помилку
- [ ] Перевірити що система не падає

**Сценарій 8.1.2: Помилка Speechmatics API**
- [ ] Встановити невалідні дані для Speechmatics
- [ ] Запустити Audio діаризацію
- [ ] Перевірити що система намагається використати Deepgram fallback
- [ ] Перевірити обробку помилки

### 8.2 Тестування валідації даних

**Сценарій 8.2.1: Невалідний транскрипт**
- [ ] Вставити порожній транскрипт
- [ ] Спробувати запустити аналіз
- [ ] Перевірити що показується повідомлення про помилку

**Сценарій 8.2.2: Невалідний аудіо файл**
- [ ] Завантажити файл не аудіо формату
- [ ] Спробувати запустити обробку
- [ ] Перевірити що показується повідомлення про помилку

### 8.3 Тестування edge cases

**Сценарій 8.3.1: Дуже довгий транскрипт**
- [ ] Вставити транскрипт з 10000+ символів
- [ ] Запустити аналіз
- [ ] Перевірити що обробка завершується успішно

**Сценарій 8.3.2: Багато спікерів**
- [ ] Завантажити аудіо з 5+ спікерами
- [ ] Запустити діаризацію
- [ ] Перевірити що всі спікери визначені

**Сценарій 8.3.3: Короткий аудіо файл**
- [ ] Завантажити аудіо менше 10 секунд
- [ ] Запустити діаризацію
- [ ] Перевірити що обробка працює коректно

---

## 9. Тестування експорту та збереження

### 9.1 Тестування експорту результатів

**Сценарій 9.1.1: Експорт JSON**
- [ ] Отримати результати діаризації
- [ ] Натиснути "Export JSON"
- [ ] Перевірити що файл завантажується
- [ ] Перевірити що JSON структура валідна

**Сценарій 9.1.2: Експорт для AI Analysis**
- [ ] Натиснути "Export for AI Analysis"
- [ ] Перевірити що файл містить правильний формат
- [ ] Перевірити що ролі (Agent/Client) відображаються правильно

### 9.2 Тестування збереження налаштувань

**Сценарій 9.2.1: Збереження API ключів**
- [ ] Ввести API ключі
- [ ] Перезавантажити сторінку
- [ ] Перевірити що ключі збережені

**Сценарій 9.2.2: Збереження налаштувань**
- [ ] Встановити налаштування (мова, кількість спікерів)
- [ ] Перемкнутися між вкладками
- [ ] Перевірити що налаштування зберігаються

---

## 10. Інтеграційне тестування

### 10.1 Повний workflow

**Сценарій 10.1.1: Повний цикл LLM діаризації**
- [ ] Завантажити транскрипт
- [ ] Обрати модель
- [ ] Запустити аналіз
- [ ] Виконати верифікацію
- [ ] Виправити помилки
- [ ] Експортувати результати

**Сценарій 10.1.2: Повний цикл Audio діаризації**
- [ ] Завантажити аудіо
- [ ] Встановити налаштування
- [ ] Запустити обробку
- [ ] Переглянути результати
- [ ] Експортувати результати

**Сценарій 10.1.3: Повний цикл Combined методу**
- [ ] Завантажити аудіо
- [ ] Встановити налаштування для Audio та LLM
- [ ] Обрати Multimodal Model
- [ ] Запустити обробку
- [ ] Перевірити всі 4 кроки
- [ ] Переглянути фінальний результат
- [ ] Експортувати результати

### 10.2 Тестування продуктивності

**Сценарій 10.2.1: Час обробки**
- [ ] Заміряти час обробки для кожного методу
- [ ] Перевірити що час обробки прийнятний
- [ ] Перевірити що Combined метод не занадто повільний

**Сценарій 10.2.2: Використання ресурсів**
- [ ] Моніторити використання пам'яті
- [ ] Перевірити що немає витоків пам'яті
- [ ] Перевірити що файли очищаються після обробки

---

## Чеклист для тестування

### Критичні функції (обов'язково протестувати):
- [ ] LLM діаризація з усіма моделями
- [ ] Audio діаризація
- [ ] Combined метод з усіма 4 кроками
- [ ] Gemini 2.5 Pro Multimodal (Google API + OpenRouter fallback)
- [ ] Comparison Agent
- [ ] Correction Agent
- [ ] Обробка помилок та fallback логіка

### Важливі функції:
- [ ] Перемикання між вкладками
- [ ] Синхронізація налаштувань
- [ ] Відображення ролей (Agent/Client)
- [ ] Фільтрація за ролями
- [ ] Експорт результатів

### Додаткові тести:
- [ ] Різні формати аудіо
- [ ] Різні мови
- [ ] Edge cases (довгі транскрипти, багато спікерів)
- [ ] UI/UX покращення

---

## Примітки для тестування

1. **Тестові дані**: Підготуйте тестові аудіо файли та транскрипти з відомими результатами
2. **API ключі**: Переконайтеся що всі API ключі встановлені та валідні
3. **Логування**: Перевіряйте логи сервера для діагностики проблем
4. **Браузер консоль**: Перевіряйте консоль браузера на помилки JavaScript
5. **Мережеві запити**: Використовуйте DevTools для моніторингу API запитів

---

## Очікувані результати

Після тестування всіх сценаріїв очікується:
- ✅ Всі методи діаризації працюють коректно
- ✅ Combined метод виконує всі 4 кроки успішно
- ✅ Gemini 2.5 Pro Multimodal працює з Google API та fallback
- ✅ Comparison та Correction агенти працюють правильно
- ✅ Обробка помилок працює з fallback логікою
- ✅ UI відображає всі результати коректно
- ✅ Експорт працює для всіх форматів

