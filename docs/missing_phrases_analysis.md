# –ê–Ω–∞–ª—ñ–∑ –ø—Ä–∏—á–∏–Ω, —á–æ–º—É —Ñ—Ä–∞–∑–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—å—Å—è –ø—Ä–∏ –≤–∏–¥—ñ–ª–µ–Ω–Ω—ñ

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏

### 1. **–°—Ç—Ä–æ–≥–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —á–∞—Å–æ–º**
**–ü—Ä–æ–±–ª–µ–º–∞**: –§—Ä–∞–∑–∏ —Ñ—ñ–ª—å—Ç—Ä—É—é—Ç—å—Å—è –∑–∞ —á–∞—Å–æ–º –∑ tolerance 0.5 —Å–µ–∫—É–Ω–¥–∏
```javascript
if (!(itemStart < segmentEnd + timeTolerance && itemEnd > segmentStart - timeTolerance)) return;
```
**–ù–∞—Å–ª—ñ–¥–∫–∏**: 
- –Ø–∫—â–æ —á–∞—Å —Ñ—Ä–∞–∑–∏ –≤ `textAnalysis` –Ω–µ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ —á–∞—Å–æ–º —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ markdown —Ç–∞–±–ª–∏—Ü—ñ, —Ñ—Ä–∞–∑–∞ –ø—Ä–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è
- –ù–µ–≤–µ–ª–∏–∫—ñ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –≤ —á–∞—Å—ñ (0.6+ —Å–µ–∫—É–Ω–¥–∏) –ø—Ä–∏–∑–≤–æ–¥—è—Ç—å –¥–æ –ø—Ä–æ–ø—É—Å–∫—É
- –Ø–∫—â–æ `segmentStart` –∞–±–æ `segmentEnd` null, —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –Ω–µ –ø—Ä–∞—Ü—é—î

### 2. **–ü—Ä–æ–±–ª–µ–º–∏ –∑ –ø–æ—à—É–∫–æ–º —Å–ª—ñ–≤ –≤ —Ç–µ–∫—Å—Ç—ñ**
**–ü—Ä–æ–±–ª–µ–º–∞**: `findWordsInText` —à—É–∫–∞—î —Å–ª–æ–≤–∞ –æ–∫—Ä–µ–º–æ, –∞–ª–µ –º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `word boundary` (`\b`), —â–æ –º–æ–∂–µ –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –¥–ª—è —Å–ª—ñ–≤ –∑ –ø—É–Ω–∫—Ç—É–∞—Ü—ñ—î—é
- –Ø–∫—â–æ —Å–ª–æ–≤–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Ñ—Ä–∞–∑–∞ –Ω–µ –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è
- `processedPositions` Set –º–æ–∂–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ñ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è

**–ö–æ–¥**:
```javascript
const regex = new RegExp(`\\b${cleanWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'gi');
// –Ø–∫—â–æ —Å–ª–æ–≤–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∑ word boundary, —à—É–∫–∞—î–º–æ –±–µ–∑ –Ω—å–æ–≥–æ
if (wordPositions.length === 0 || !wordPositions.some(pos => pos.word.toLowerCase() === word.toLowerCase())) {
  // Fallback –ø–æ—à—É–∫
}
```

### 3. **–†—ñ–∑–Ω–∏—Ü—è –≤ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–µ–∫—Å—Ç—É**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ `textAnalysis.js` —Ç–∞ `highlightTextWithColors` –º–æ–∂–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—è
- `textAnalysis.js`: `normalizeText()` –≤–∏–¥–∞–ª—è—î –≤—Å—é –ø—É–Ω–∫—Ç—É–∞—Ü—ñ—é
- `highlightTextWithColors`: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ–Ω—à—É –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è –ø–æ—à—É–∫—É
- –§—Ä–∞–∑–∞ –º–æ–∂–µ –±—É—Ç–∏ –≤ `textAnalysis`, –∞–ª–µ –Ω–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏—Å—è –≤ —Ç–µ–∫—Å—Ç—ñ —á–µ—Ä–µ–∑ —Ä—ñ–∑–Ω–∏—Ü—é –≤ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó

### 4. **–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Å–ø—ñ–∫–µ—Ä–æ–º**
**–ü—Ä–æ–±–ª–µ–º–∞**: –§—Ä–∞–∑–∏ —Ñ—ñ–ª—å—Ç—Ä—É—é—Ç—å—Å—è –∑–∞ —Å–ø—ñ–∫–µ—Ä–æ–º, –∞–ª–µ —è–∫—â–æ —Å–ø—ñ–∫–µ—Ä –Ω–µ –∑–±—ñ–≥–∞—î—Ç—å—Å—è:
- –§—Ä–∞–∑–∞ –Ω–µ –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è –≤ Blue/Green
- –ú–∞—î –±—É—Ç–∏ –≤ Red, –∞–ª–µ —è–∫—â–æ –≤–æ–Ω–∞ —î –≤ –¥–∂–µ—Ä–µ–ª–∞—Ö, –≤–æ–Ω–∞ –Ω–µ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ Red
- –ú–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫—É —Ñ—Ä–∞–∑–∏

**–ö–æ–¥**:
```javascript
if (segmentSpeaker && item.speaker) {
  const normalizedItemSpeaker = normalizeSpeaker(item.speaker);
  if (normalizedSegmentSpeaker && normalizedItemSpeaker && normalizedSegmentSpeaker !== normalizedItemSpeaker) {
    return; // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ
  }
}
```

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏

### 5. **–ü–æ—Ä–æ–≥–∏ —Å—Ö–æ–∂–æ—Å—Ç—ñ –∑–∞–Ω–∞–¥—Ç–æ –≤–∏—Å–æ–∫—ñ**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Ä–æ–≥–∏ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Ñ—Ä–∞–∑ –≤ `existsInPrimary`:
- Blue: 0.65 (–∞–±–æ 0.5 –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö)
- Green: 0.6 (–∞–±–æ 0.45 –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö)
- Red: 0.55 (–∞–±–æ 0.45 –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö)

–Ø–∫—â–æ —Å—Ö–æ–∂—ñ—Å—Ç—å –Ω–∏–∂—á–∞ –∑–∞ –ø–æ—Ä—ñ–≥, —Ñ—Ä–∞–∑–∞ –Ω–µ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é.

### 6. **Time tolerance –≤ existsInPrimary –∑–∞–Ω–∞–¥—Ç–æ –º–∞–ª–∏–π**
**–ü—Ä–æ–±–ª–µ–º–∞**: 
- Blue: 2.5 —Å–µ–∫—É–Ω–¥–∏
- Green: 3.0 —Å–µ–∫—É–Ω–¥–∏
- Red: 2.5 —Å–µ–∫—É–Ω–¥–∏

–Ø–∫—â–æ —Å–µ–≥–º–µ–Ω—Ç–∏ –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—Ç—å—Å—è –∑–∞ —á–∞—Å–æ–º —ñ —á–∞—Å–æ–≤–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å > tolerance, —Ñ—Ä–∞–∑–∞ –Ω–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è.

### 7. **–ü—Ä–æ–±–ª–µ–º–∏ –∑ –ø–∞—Ä—Å–∏–Ω–≥–æ–º markdown —Ç–∞–±–ª–∏—Ü—ñ**
**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫—â–æ markdown —Ç–∞–±–ª–∏—Ü—è –ø–∞—Ä—Å–∏—Ç—å—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç (–Ω–µ 5 –∫–æ–ª–æ–Ω–æ–∫)
- –ü–æ–º–∏–ª–∫–∏ –≤ –ø–∞—Ä—Å–∏–Ω–≥—É —á–∞—Å—É
- –ü–æ—Ä–æ–∂–Ω—ñ –∫–æ–º—ñ—Ä–∫–∏

–§—Ä–∞–∑–∏ –∑ markdown –Ω–µ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –≤ Red.

### 8. **–î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è –º—ñ–∂ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏**
**–ü—Ä–æ–±–ª–µ–º–∞**: –§—Ä–∞–∑–∏ –≤–∏–∫–ª—é—á–∞—é—Ç—å—Å—è –∑ –æ–¥–Ω—ñ—î—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó, —è–∫—â–æ –≤–æ–Ω–∏ —î –≤ —ñ–Ω—à—ñ–π:
- Blue –º–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ Green
- Blue —ñ Green –º–∞—é—Ç—å –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ Red

–Ø–∫—â–æ —Ñ—Ä–∞–∑–∞ –ø–æ–º–∏–ª–∫–æ–≤–æ –ø–æ—Ç—Ä–∞–ø–∏–ª–∞ –≤ –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, –≤–æ–Ω–∞ –Ω–µ –∑'—è–≤–∏—Ç—å—Å—è –≤ —ñ–Ω—à—ñ–π.

### 9. **–ü—Ä–æ–±–ª–µ–º–∏ –∑ word boundary –¥–ª—è —Å–ª—ñ–≤ –∑ –ø—É–Ω–∫—Ç—É–∞—Ü—ñ—î—é**
**–ü—Ä–æ–±–ª–µ–º–∞**: `findWordsInText` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `\b` (word boundary), —â–æ –Ω–µ –ø—Ä–∞—Ü—é—î –¥–ª—è:
- –°–ª—ñ–≤ –∑ –∞–ø–æ—Å—Ç—Ä–æ—Ñ–∞–º–∏: "I'm", "don't"
- –°–∫–æ—Ä–æ—á–µ–Ω—å: "Dr.", "Mr."
- –°–ª—ñ–≤ –∑ –¥–µ—Ñ—ñ—Å–∞–º–∏: "well-known"

**–ö–æ–¥**:
```javascript
const regex = new RegExp(`\\b${cleanWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'gi');
```

### 10. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å fallback –¥–ª—è —Ñ—Ä–∞–∑, —è–∫—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ –ø–æ —Å–ª–æ–≤–∞—Ö**
**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫—â–æ `findWordsInText` –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ä–æ–∂–Ω—ñ–π –º–∞—Å–∏–≤, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `findPhraseInText`:
- –ê–ª–µ `findPhraseInText` —Ç–∞–∫–æ–∂ –º–æ–∂–µ –Ω–µ –∑–Ω–∞–π—Ç–∏ —Ñ—Ä–∞–∑—É
- –Ø–∫—â–æ –æ–±–∏–¥–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å —Ñ—Ä–∞–∑—É, –≤–æ–Ω–∞ –Ω–µ –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è
- –ù–µ–º–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Å–ø—Ä–æ–± –∑ —Ä—ñ–∑–Ω–∏–º–∏ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó

## üü° –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏

### 11. **–ü—Ä–æ–±–ª–µ–º–∏ –∑ –æ–±—Ä–æ–±–∫–æ—é –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑**
**–ü—Ä–æ–±–ª–µ–º–∞**: –•–æ—á–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞ –∑–Ω–∏–∂–µ–Ω–∞ –¥–æ 1 —Å–∏–º–≤–æ–ª—É, –∫–æ—Ä–æ—Ç–∫—ñ —Ñ—Ä–∞–∑–∏ –≤—Å–µ —â–µ –º–æ–∂—É—Ç—å –ø—Ä–æ–ø—É—Å–∫–∞—Ç–∏—Å—è:
- –ü–æ—Ä–æ–≥–∏ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑ –Ω–∏–∂—á—ñ, –∞–ª–µ –≤—Å–µ —â–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–º–∏
- –ö–æ—Ä–æ—Ç–∫—ñ —Ñ—Ä–∞–∑–∏ –≤–∞–∂—á–µ –∑–Ω–∞–π—Ç–∏ –≤ —Ç–µ–∫—Å—Ç—ñ —á–µ—Ä–µ–∑ word boundary

### 12. **–ü—Ä–æ–±–ª–µ–º–∏ –∑ –æ–±—Ä–æ–±–∫–æ—é –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è —Å–µ–≥–º–µ–Ω—Ç—ñ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫—â–æ —Å–µ–≥–º–µ–Ω—Ç–∏ –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—Ç—å—Å—è –∑–∞ —á–∞—Å–æ–º:
```javascript
if (timeOverlap === 0 && timeDistance > timeTolerance) continue;
```
–§—Ä–∞–∑–∞ –ø—Ä–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Ç–µ–∫—Å—Ç —Å—Ö–æ–∂–∏–π.

### 13. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö —Ñ—Ä–∞–∑**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–º–∞—î –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è, —á–æ–º—É —Ñ—Ä–∞–∑–∞ –Ω–µ –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è:
- –ß–∏ –ø—Ä–æ–π—à–ª–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –∑–∞ —á–∞—Å–æ–º?
- –ß–∏ –∑–Ω–∞–π–¥–µ–Ω–∞ –≤ —Ç–µ–∫—Å—Ç—ñ?
- –ß–∏ –ø—Ä–æ–π—à–ª–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Å–ø—ñ–∫–µ—Ä–∞?

### 14. **–ü—Ä–æ–±–ª–µ–º–∏ –∑ –æ–±—Ä–æ–±–∫–æ—é —Ñ—Ä–∞–∑ –∑ markdown (Green)**
**–ü—Ä–æ–±–ª–µ–º–∞**: Green —Ñ—Ä–∞–∑–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ "text1 | text2":
```javascript
const parts = item.text.split('|').map(p => p.trim()).filter(p => p.length > 0);
```
–Ø–∫—â–æ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–µ –∞–±–æ —á–∞—Å—Ç–∏–Ω–∏ –Ω–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è, —Ñ—Ä–∞–∑–∞ –Ω–µ –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è.

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

1. **–ó–±—ñ–ª—å—à–∏—Ç–∏ time tolerance** –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–º
2. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –ø–æ—à—É–∫ —Å–ª—ñ–≤** - –¥–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ fallback –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
3. **–£–Ω—ñ—Ñ—ñ–∫—É–≤–∞—Ç–∏ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó
4. **–î–æ–¥–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è** - –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏, —á–æ–º—É —Ñ—Ä–∞–∑–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—å—Å—è
5. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É —Å–ª—ñ–≤ –∑ –ø—É–Ω–∫—Ç—É–∞—Ü—ñ—î—é** - –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ word boundary –¥–ª—è —Ç–∞–∫–∏—Ö —Å–ª—ñ–≤
6. **–î–æ–¥–∞—Ç–∏ fallback –º–µ—Ö–∞–Ω—ñ–∑–º–∏** - —è–∫—â–æ —Å–ª–æ–≤–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏
7. **–ó–º–µ–Ω—à–∏—Ç–∏ –ø–æ—Ä–æ–≥–∏ —Å—Ö–æ–∂–æ—Å—Ç—ñ** –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ —ó—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–º–∏
8. **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è —Å–µ–≥–º–µ–Ω—Ç—ñ–≤** - –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –Ω–µ —Ç—ñ–ª—å–∫–∏ start, –∞–ª–µ –π end —á–∞—Å

